---
title: "2.1. 非兼容版本协商"
anchor: "2.1_Incompatible_Version_Negotiation"
weight: 210
rank: "h2"
---


服务端通过发送版本协商包启动非兼容版本协商。
该包{{< req_level SHALL >}}在一个支持版本字段（Supported Version filed）中包含来自服务端提供版本（详见[第5章]()）集合的每个入口。
服务端{{< req_level MAY >}}往支持版本字段中添加保留版本（如《[]()》[第6.3章]()所述）。

如果版本协商包包含客户端提供的初始版本，客户端可将忽略该包，如[第4章]()所述。
客户端也会忽略保护不正确连接ID字段的版本协商包，如《[]()》[第6章]()所述。

在收到版本协商包后，客户端{{< req_level SHALL >}}在服务端提供的列表中搜索一个其支持的版本。
如果没有找到这样的版本，其{{< req_level SHALL >}}中止连接尝试。
否则，其{{< req_level SHALL >}}选择一个相互支持的版本并以该版本发送一个新的首飞——该版本就是当前的协商版本。

新的首飞将允许终端使用协商版本创建连接。
协商版本的握手将交换版本信息（详见[第3章]()），用于确保版本协商的真实性，也即没有攻击者为了影响版本协商过程中途注入数据包（详见[第4章]()）。

只有服务端可以发起非兼容版本协商。
客户端{{< req_level MUST_NOT >}}能发送版本协商包，且服务端{{< req_level MUST >}}忽略所有收到的版本协商包。
