---
title: "2. 版本协商机制"
anchor: "2_Version_Negotiation_Mechanism"
weight: 200
rank: "h1"
---

本文指出了两个版本协商的结果：1、“不兼容的”，需要一个额外的往返且适用于所有版本，以及2、“兼容的”，可以保留一个往返但是只适用于兼容的版本之间（详见[第2.2章]()）。

客户端通过选择一个初始版本，发送长包头的首飞QUIC包给服务端，以初始化QUIC连接<sup>《》</sup>。
客户端的首飞包括版本信息（详见[第3章]()），
将被用于可选地开启兼容的版本协商（详见[第2.3章]()），且阻止版本降级攻击（详见[第4章]()）。

在收到首飞后，服务端检验其是否知道如何从选择版本（此种场景下也即初始版本）解析首飞包。
如果其不能解析，则启动不兼容的版本协商（详见），这会导致客户端使用另一个版本初始化一条新连接。
例如，如果客户端使用服务端不能解析的版本A初始化一条连接，服务端启动不兼容版本协商；然后，客户端使用版本B初始化一条连接，则说第一条连接的客户端选择版本是A，第二条连接的客户端选择版本是B，而整个过程的初始版本是A。

如果服务端可以解析首飞，则它可以使用客户端选择版本建立连接，也{{< req_level MAY >}}选择其他兼容的版本，详见[第2.3章]()。

注意，服务端也可能有能力解析首飞，即使其无法完整支持给定的版本，其在解析首飞以进行版本确认方面的实现是足够的，但是不足以完整地使用相应版本建立连接。
